<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>진료 내역 상세</title>
    <link rel="stylesheet" th:href="@{/css/global.css}" />
</head>

<body>

    <div th:replace="layout/header :: headerFragment"></div>

    <main class="main-layout">
        <div class="page-header">
            <div>
                <h1 class="page-title">진료 내역 상세</h1>
                <p class="page-subtitle">환자의 진료 기록 및 처방 내역</p>
            </div>
        </div>

        <div class="grid" style="grid-template-columns: 1fr; gap: 30px;">
            <!-- 진료 내용 카드 -->
            <div class="card">
                <h3 class="text-primary" style="margin-bottom: 20px; font-size: 1.3em;">진료 소견</h3>
                <div class="grid grid-2" style="gap: 20px;">
                    <div>
                        <span class="text-muted" style="display: block; font-size: 0.9em;">진료일</span>
                        <strong style="font-size: 1.1em;"
                            th:text="${#temporals.format(record.treatmentDate, 'yyyy-MM-dd HH:mm')}"></strong>
                    </div>
                    <div>
                        <span class="text-muted" style="display: block; font-size: 0.9em;">진단명</span>
                        <strong style="font-size: 1.1em; color: var(--accent);" th:text="${record.diagnosis}"></strong>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <span class="text-muted" style="display: block; font-size: 0.9em; margin-bottom: 5px;">치료 내용</span>
                    <div style="background-color: var(--bg-body); padding: 15px; border-radius: var(--radius-sm);">
                        <p style="margin: 0; white-space: pre-wrap;" th:text="${record.treatment}"></p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="text-primary" style="margin-bottom: 20px; font-size: 1.3em;">처방 내역</h3>

                <div th:if="${#lists.isEmpty(record.prescriptions)}"
                    style="text-align: center; padding: 20px; color: var(--text-muted);">
                    처방된 약이 없습니다.
                </div>

                <div class="table-wrapper" th:unless="${#lists.isEmpty(record.prescriptions)}">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="10%">No</th>
                                <th width="40%">약품명</th>
                                <th width="30%">복용법</th>
                                <th width="20%">투약 일수</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="med, stat : ${record.prescriptions}">
                                <td th:text="${stat.count}">1</td>
                                <td th:text="${med.medicationName}" style="font-weight: 600;"></td>
                                <td th:text="${med.dosage}"></td>
                                <td th:text="|${med.durationDays}일|"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="flex gap-2 justify-center" style="margin-top: 40px;">
            <a th:href="@{/records/{id}/edit(id=${record.treatmentNum})}" class="btn btn-secondary">수정</a>
            <a href="/reservations" class="btn btn-outline">목록으로</a>
        </div>
    </main>

    <div th:replace="layout/footer :: footerFragment"></div>

</body>

</html>