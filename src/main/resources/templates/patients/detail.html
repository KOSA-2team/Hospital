<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í™˜ì ìƒì„¸ ì •ë³´</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 10px; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        .btn-action { text-decoration: none; padding: 5px 10px; color: white; border-radius: 4px; }
        .btn-start { background-color: #007bff; }
        .btn-view { background-color: #6c757d; }
    </style>
</head>
<body>

<h1>í™˜ì ìƒì„¸ ì •ë³´</h1>

<ul>
    <li>ì°¨íŠ¸ë²ˆí˜¸: <span th:text="${patient.patient_num}"></span></li>
    <li>ì´ë¦„: <strong th:text="${patient.name}"></strong></li>
    <li>ì—°ë½ì²˜: <span th:text="${patient.phone}"></span></li>
    <li>ìƒë…„ì›”ì¼: <span th:text="${#temporals.format(patient.birth_date, 'yyyy-MM-dd')}"></span></li>
    <li>ì„±ë³„: <span th:text="${patient.gender.description}"></span></li>
    <li>ê°€ì…ì¼: <span th:text="${#temporals.format(patient.created_at, 'yyyy-MM-dd HH:mm')}"></span></li>
</ul>

<div>
    <button th:onclick="|location.href='@{/patients/{id}/edit(id=${patient.patient_num})}'|">ì •ë³´ ìˆ˜ì •</button>

    <form th:action="@{/patients/{id}/delete(id=${patient.patient_num})}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">í™˜ì ì‚­ì œ</button>
    </form>

    <a href="/patients">ëª©ë¡ìœ¼ë¡œ</a>
</div>

<hr>

<h3>â³ ì§„ë£Œ ëŒ€ê¸° ëª©ë¡ (ì˜ˆì•½)</h3>

<div th:if="${#lists.isEmpty(reservations)}">
    <p>ì˜ˆì•½ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
</div>

<table th:unless="${#lists.isEmpty(reservations)}">
    <thead>
    <tr>
        <th>ì˜ˆì•½ì¼ì‹œ</th>
        <th>ë‹´ë‹¹ì˜</th>
        <th>ìƒíƒœ</th>
        <th>ê´€ë¦¬ (ì§„ë£Œ)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="res : ${reservations}">
        <td th:text="${#temporals.format(res.reservationDate, 'yyyy-MM-dd HH:mm')}"></td>
        <td th:text="${res.doctorName}"></td>
        <td><span th:text="${res.statusDescription}"></span></td>
        <td>
            <a th:if="${res.status == 1}"
               th:href="@{/records/new(reservationNum=${res.reservationNum})}"
               class="btn-action btn-start">
                ğŸ©º ì§„ë£Œ ì°¨íŠ¸ ì‘ì„±
            </a>

            <span th:if="${res.status == 0}">ìŠ¹ì¸ ëŒ€ê¸°</span>
            <span th:if="${res.status == 3}" style="color: green;">ì§„ë£Œ ì™„ë£Œ</span>
            <span th:if="${res.status == 2}" style="color: gray;">ì·¨ì†Œë¨</span>
        </td>
    </tr>
    </tbody>
</table>

<hr>

<h3>ê³¼ê±° ì§„ë£Œ ê¸°ë¡</h3>

<div th:if="${#lists.isEmpty(historyList)}">
    <p>ê³¼ê±° ì§„ë£Œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
</div>

<table th:unless="${#lists.isEmpty(historyList)}">
    <thead>
    <tr>
        <th>ì§„ë£Œì¼</th>
        <th>ì§„ë‹¨ëª…</th>
        <th>ë‹´ë‹¹ì˜</th>
        <th>ìƒì„¸ë³´ê¸°</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="hist : ${historyList}">
        <td th:text="${#temporals.format(hist.treatmentDate, 'yyyy-MM-dd')}"></td>
        <td th:text="${hist.diagnosis}"></td>
        <td th:text="${hist.doctorName}"></td>
        <td>
            <a th:href="@{/records/{id}(id=${hist.treatmentNum})}" class="btn-action btn-view">
                ìƒì„¸
            </a>
        </td>
    </tr>
    </tbody>
</table>

</body>
</html>