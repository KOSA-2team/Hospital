<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>2팀 병원 시스템</title>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <style>
      :root {
        --primary: #000080; /* 메인 남색 */
        --accent: #00b894; /* 강조 민트색 */
        --bg: #f5f7fa; /* 배경 회색 */
        --text: #2d3436; /* 본문 글자색 */
        --sidebar-w: 250px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Pretendard", sans-serif;
        margin: 0;
        display: block;
        min-height: 100vh;
        background-color: var(--bg);
        color: var(--text);
      }

      main > header {
        width: calc(100% + 80px);
        margin-left: -40px;
        margin-right: -40px;
        padding: 20px 40px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .header-actions {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .header-actions .search-box {
        width: 320px;
      }

      .header-actions .search-box input {
        width: 100%;
        padding: 10px;
        border: 1px solid #e6e9ee;
        border-radius: 8px;
        background: white;
        color: var(--text);
      }

      .header-actions .search-box input::placeholder {
        color: #b2bec3;
      }

      .quick-btn {
        display: inline-block;
        padding: 10px 14px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        color: white;
        cursor: pointer;
      }
      .btn-green {
        background-color: var(--accent);
      }
      .btn-orange {
        background-color: #f39c12;
      }

      /* 메인 */
      main {
        padding: 40px;
        overflow-y: auto;
      }

      main > header h1 {
        margin: 0;
        color: var(--primary);
      }
      main > header p {
        color: #636e72;
        margin-top: 5px;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: 3fr 1fr;
        gap: 20px;
      }

      /* 카드 */
      .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .card h3 {
        margin-top: 0;
        color: var(--primary);
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }

      /* 현황판 */
      .status-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }
      .stat-box {
        flex: 1;
        text-align: center;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }
      .stat-box h4 {
        margin: 0 0 10px 0;
        color: #636e72;
      }
      .stat-box span {
        font-size: 2rem;
        font-weight: bold;
        color: var(--primary);
      }

      /* 테이블 */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background-color: #f8f9fa;
        color: #444;
      }

      /* 버튼 */
      .btn-sm {
        padding: 6px 12px;
        border-radius: 6px;
        border: none;
        color: white;
        cursor: pointer;
      }
      .bg-blue {
        background-color: #3949ab;
      }
      .bg-gray {
        background-color: #95a5a6;
      }

      /* 우측 리스트 */
      .list-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }
      .tag {
        background: #e8eaf6;
        color: var(--primary);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.8rem;
      }

      /* 메인 컨테이너*/
      .main-container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
        min-height: 600px;
      }
    </style>
  </head>
  <body>
    <div th:replace="layout/header :: headerFragment"></div>

    <main class="main-container">
      <header>
        <div>
          <h1>메인 대시보드</h1>
          <p th:text="${#temporals.format(todayDate, 'yyyy년 MM월 dd일 (E)')}">
            2025년 12월 03일
          </p>
        </div>

        <div class="header-actions">
          <div class="search-box">
            <form action="/search" method="get">
              <input
                type="text"
                name="keyword"
                placeholder="환자명/의사명 검색..."
                autocomplete="off"
              />
            </form>
          </div>

          <button
            class="quick-btn btn-green"
            onclick="location.href='/patient/register'"
          >
            + 환자 등록
          </button>
          <button
            class="quick-btn btn-orange"
            onclick="location.href='/reservation/register'"
          >
            + 예약 하기
          </button>
        </div>
      </header>

      <div class="dashboard-grid">
        <div>
          <div class="status-row">
            <div class="stat-box">
              <h4>총 예약</h4>
              <span th:text="${totalCount}">0</span>
            </div>
            <div class="stat-box">
              <h4>진료 대기</h4>
              <span th:text="${waitingCount}" style="color: #f39c12">0</span>
            </div>
            <div class="stat-box">
              <h4>신규 환자</h4>
              <span th:text="${newPatientCount}" style="color: var(--accent)"
                >0</span
              >
            </div>
          </div>

          <div class="card">
            <h3>오늘의 진료 일정</h3>
            <table>
              <thead>
                <tr>
                  <th>시간</th>
                  <th>환자명</th>
                  <th>의사명</th>
                  <th>관리</th>
                </tr>
              </thead>
              <tbody>
                <tr th:if="${#lists.isEmpty(scheduleList)}">
                  <td colspan="4" style="text-align: center">
                    일정이 없습니다.
                  </td>
                </tr>
                <tr th:each="schedule : ${scheduleList}">
                  <td th:text="${schedule.time}">14:00</td>
                  <td>
                    <a
                      th:href="@{/patient/detail/{id}(id=${schedule.patient_id})}"
                      th:text="${schedule.patient_name}"
                      style="
                        color: var(--primary);
                        font-weight: bold;
                        text-decoration: none;
                      "
                    >
                      홍길동
                    </a>
                  </td>
                  <td th:text="${schedule.doctor_name}">김의사</td>
                  <td>
                    <button
                      class="btn-sm bg-blue"
                      th:if="${schedule.status == 1}"
                    >
                      진료 시작
                    </button>
                    <button
                      class="btn-sm bg-gray"
                      th:if="${schedule.status == 3}"
                    >
                      차트 보기
                    </button>
                    <span
                      th:unless="${schedule.status == 1 or schedule.status == 3}"
                      th:text="${schedule.statusName}"
                      >-</span
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div>
          <div class="card" style="margin-bottom: 20px">
            <h3>의료진 현황</h3>
            <div th:each="doctor : ${doctorList}" class="list-item">
              <span th:text="${doctor.mname}">이름</span>
              <span class="tag" th:text="${doctor.specialty}">전공</span>
            </div>
          </div>

          <div class="card" style="text-align: center">
            <h3>월간 신규</h3>
            <div
              style="
                font-size: 3rem;
                font-weight: bold;
                color: var(--accent);
                margin: 20px 0;
              "
            >
              <span th:text="${monthlyNewCount}">0</span>
            </div>
            <p style="color: #ccc; margin: 0">(명)</p>
          </div>
        </div>
      </div>
    </main>
    <div th:replace="layout/footer :: footerFragment"></div>
  </body>
</html>
