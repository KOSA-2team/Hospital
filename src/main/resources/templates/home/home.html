<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>KOSA 병원 - 대시보드</title>
    <link rel="stylesheet" th:href="@{/css/global.css}" />
</head>

<body>
    <div th:replace="layout/header :: headerFragment"></div>

    <main class="main-layout">
        <div class="page-header">
            <div>
                <h1 class="page-title">메인 대시보드</h1>
                <p class="page-subtitle" th:text="${#temporals.format(todayDate, 'yyyy년 MM월 dd일 (E)')}">
                    2025년 12월 03일
                </p>
            </div>

            <div class="flex items-center gap-4">
                <div class="search-box">
                    <form action="/search" method="get">
                        <input type="text" name="keyword" placeholder="환자명/의사명 검색..." autocomplete="off"
                            class="form-input" style="width: 300px;" />
                    </form>
                </div>

                <button class="btn btn-accent" onclick="location.href='/patients/new'">
                    + 환자 등록
                </button>
                <button class="btn btn-primary" onclick="location.href='/reservations/new'">
                    + 예약 하기
                </button>
            </div>
        </div>

        <!-- 상태 요약 카드 -->
        <div class="grid grid-cols-3 mb-4" style="margin-bottom: 24px;">
            <div class="stat-box">
                <span class="stat-label">총 예약</span>
                <span class="stat-value primary" th:text="${totalCount}">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">진료 대기</span>
                <span class="stat-value accent" th:text="${waitingCount}">0</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">신규 환자</span>
                <span class="stat-value secondary" th:text="${newPatientCount}">0</span>
            </div>
        </div>

        <!-- 메인 콘텐츠 영역 -->
        <div class="grid" style="grid-template-columns: 3fr 1fr;">
            <!-- 오늘의 진료 일정 테이블 -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">오늘의 진료 일정</h3>
                </div>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th width="25%">시간</th>
                                <th width="25%">환자명</th>
                                <th width="25%">의사명</th>
                                <th width="25%">상태</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(scheduleList)}">
                                <td colspan="4" style="text-align: center; color: var(--text-muted); padding: 30px;">
                                    예정된 일정이 없습니다.
                                </td>
                            </tr>
                            <tr th:each="schedule : ${scheduleList}">
                                <td class="text-muted" th:text="${schedule.time}">14:00</td>
                                <td>
                                    <a th:href="@{/patients/{id}(id=${schedule.patient_id})}"
                                        th:text="${schedule.patient_name}" class="text-primary"
                                        style="font-weight: 600;">
                                        홍길동
                                    </a>
                                </td>
                                <td th:text="${schedule.doctor_name}">김의사</td>
                                <td>
                                    <!-- 상태만 표시 (버튼 제거) -->
                                    <span class="badge"
                                        th:classappend="${schedule.status} == 0 ? 'badge-green' : (${schedule.status} == 1 ? 'badge-blue' : (${schedule.status} == 2 ? 'badge-red' : 'badge-gray'))"
                                        th:text="${schedule.statusName}">
                                        상태
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 우측 사이드: 의료진 상태 및 월간 통계 -->
            <div class="flex flex-col gap-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">의료진 현황</h3>
                    </div>
                    <div class="flex flex-col gap-2">
                        <div th:each="doctor : ${doctorList}" class="flex justify-between items-center"
                            style="padding: 8px 0; border-bottom: 1px solid var(--border);">
                            <span style="font-weight: 500;" th:text="${doctor.mname}">이름</span>
                            <span class="badge badge-blue" th:text="${doctor.specialty}">전공</span>
                        </div>
                    </div>
                </div>

                <div class="card"
                    style="text-align: center; display: flex; flex-direction: column; justify-content: center;">
                    <h3 class="card-title" style="margin-bottom: 10px;">월간 신규 환자</h3>
                    <div style="font-size: 3rem; font-weight: 800; color: var(--secondary); margin: 10px 0;">
                        <span th:text="${monthlyNewCount}">0</span>
                    </div>
                    <p class="text-muted" style="margin: 0;">(명)</p>
                </div>
            </div>
        </div>
    </main>
    <div th:replace="layout/footer :: footerFragment"></div>
</body>

</html>